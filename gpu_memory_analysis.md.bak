# GPU Memory Analysis - All JustNews Agents

## Current Problematic Configuration

### NewsReader V2 (CURRENT - PROBLEMATIC)
- **Model**: `llava-hf/llava-1.5-7b-hf` (7 billion parameters)
- **Current Memory Usage**: 7.6GB GPU (observed via nvidia-smi)
- **Configuration**: INT8 quantization with crash-safe mode (8GB limit)
- **Status**: ⚠️ **CAUSING SYSTEM CRASHES** - Too much memory usage

## Agent-by-Agent GPU Memory Analysis

### 1. NewsReader V2 (Priority Fix Needed)
**Current**:
- Model: LLaVA-1.5-7B-HF (7B parameters)
- Memory: 7.6GB (with INT8 quantization)
- Issues: System crashes, excessive memory usage

**Proposed Fix**:
- Model: `llava-hf/llava-onevision-qwen2-0.5b-ov-hf` (0.9B parameters)
- Expected Memory: ~1.2GB (with INT8 quantization)
- Memory Reduction: **87% reduction** (7.6GB → 1.2GB)
- Capabilities: Same vision-language abilities, newer architecture

### 2. Scout Agent
- **Model**: LLaMA-3-8B with INT4 quantization (from gpu_scout_engine.py)
- **Expected Memory**: ~4-5GB
- **Current Status**: Not fully loaded due to NewsReader consuming too much memory

### 3. Analyst Agent
- **Models**: 
  - `cardiffnlp/twitter-roberta-base-sentiment-latest` (FP16)
  - `unitary/toxic-bert` (FP16)
- **Expected Memory**: ~1.5GB total
- **Status**: Lightweight, proven to work

### 4. Memory Agent
- **Models**:
  - BERT for content classification
  - SentenceTransformer (`sentence-transformers/all-MiniLM-L6-v2`)
- **Expected Memory**: ~1.0GB total
- **Status**: Lightweight embedding models

### 5. Synthesizer Agent
- **Models**:
  - SentenceTransformer (`sentence-transformers/all-MiniLM-L6-v2`) with FP16
  - KMeans clustering (CPU-based)
- **Expected Memory**: ~0.8GB
- **Status**: Optimized with GPU acceleration

### 6. Fact Checker Agent
- **Model**: `facebook/bart-large-mnli` or `microsoft/DialoGPT-large`
- **Expected Memory**: ~1.5-2.0GB
- **Status**: Pipeline-based, moderate memory usage

### 7. Critic Agent
- **Model**: DialoGPT-medium or similar
- **Expected Memory**: ~1.5GB
- **Status**: Standard language model

### 8. Chief Editor & Reasoning Agents
- **Models**: Lightweight processing models
- **Expected Memory**: ~0.5GB each
- **Status**: Minimal GPU usage

## Total GPU Memory Calculation

### Current Configuration (PROBLEMATIC)
```
GPU Memory Usage (24GB Total):
├── NewsReader V2 (LLaVA-7B):    7.6GB ⚠️ PROBLEMATIC
├── Scout (LLaMA-3-8B):         ~5.0GB (estimated)
├── Analyst:                    ~1.5GB
├── Memory:                     ~1.0GB
├── Synthesizer:                ~0.8GB
├── Fact Checker:               ~2.0GB
├── Critic:                     ~1.5GB
├── Other agents:               ~1.0GB
├── System/OS GPU usage:        ~0.5GB
└── TOTAL:                      ~20.9GB ⚠️ TOO HIGH
```
**Result**: System crashes due to GPU memory exhaustion

### Proposed Configuration (OPTIMAL)
```
GPU Memory Usage (24GB Total):
├── NewsReader V2 (LLaVA-0.9B):  1.2GB ✅ 87% REDUCTION
├── Scout (LLaMA-3-8B):          5.0GB
├── Analyst:                     1.5GB
├── Memory:                      1.0GB
├── Synthesizer:                 0.8GB
├── Fact Checker:                2.0GB
├── Critic:                      1.5GB
├── Other agents:                1.0GB
├── System/OS GPU usage:         0.5GB
├── Safety Buffer:               9.5GB ✅ SAFE MARGIN
└── TOTAL:                       14.5GB ✅ OPTIMAL
```
**Result**: Stable operation with 40% GPU memory headroom

## Recommended Action

### Immediate Fix: Replace LLaVA Model
1. **Change Model**: `llava-hf/llava-1.5-7b-hf` → `llava-hf/llava-onevision-qwen2-0.5b-ov-hf`
2. **Memory Savings**: 7.6GB → 1.2GB (87% reduction)
3. **Capabilities**: Same vision-language processing, newer OneVision architecture
4. **Compatibility**: Drop-in replacement with same API

### Model Comparison
| Aspect | Current (LLaVA-1.5-7B) | Proposed (LLaVA-OneVision-0.5B) |
|--------|------------------------|----------------------------------|
| Parameters | 7 billion | 893 million |
| GPU Memory | 7.6GB | ~1.2GB |
| Vision Tasks | ✅ Yes | ✅ Yes |
| Text Generation | ✅ Yes | ✅ Yes |
| Architecture | LLaVA 1.5 | LLaVA OneVision (newer) |
| Performance | High quality | High quality (newer architecture) |
| System Impact | ⚠️ Causes crashes | ✅ Stable |

## Implementation Priority
This fix should be implemented **immediately** as it's the root cause of system crashes.

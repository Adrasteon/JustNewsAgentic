[Unit]
Description=JustNews Service (%i)
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
# Global and per-instance environment files (optional but recommended)
EnvironmentFile=-/etc/justnews/global.env
EnvironmentFile=-/etc/justnews/%i.env
# Start from a shell to allow cd into repo and use env var expansion safely
ExecStartPre=/bin/bash -c '[ "${REQUIRE_BUS:-1}" = "0" ] || /usr/local/bin/wait_for_mcp.sh'
ExecStart=/bin/bash -c 'cd "${REPO_DIR}" && exec "${JUSTNEWS_PYTHON}" -m uvicorn "${MODULE:-main}:${APP:-app}" --host 0.0.0.0 --port "${PORT:-8000}"'
Restart=on-failure
RestartSec=3
LimitNOFILE=65535
# On failure, emit a brief log tail for diagnostics
OnFailure=justnews-failure@%i.service
# Uncomment to restrict core dumps and add basic security hardening
# NoNewPrivileges=true
# PrivateTmp=true
# ProtectSystem=full
# ProtectHome=yes

[Install]
WantedBy=multi-user.target
